<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.personal.website.mapper.DocumentMapper">

    <!-- 结果映射 -->
    <resultMap id="DocumentResultMap" type="com.personal.website.pojo.Document">
        <id property="uuid" column="uuid"/>  <!-- 修改为主键 -->
        <result property="drafter" column="drafter"/>
        <result property="draftTime" column="draft_time"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="type" column="type"/>
        <result property="secondaryCategory" column="secondary_category"/>
        <result property="tertiaryCategory" column="tertiary_category"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <!-- 插入文档 -->
    <insert id="insertDocument" parameterType="com.personal.website.pojo.Document">
        INSERT INTO documents (
            uuid,
            drafter,
            draft_time,
            title,
            content,
            type,
            secondary_category,
            tertiary_category
        ) VALUES (
                     #{uuid},
                     #{drafter},
                     NOW(),
                     #{title},
                     #{content},
                     #{type},
                     #{secondaryCategory},
                     #{tertiaryCategory}
                 )
    </insert>

    <!-- 查询所有文档 -->
    <select id="selectAllDocuments" resultMap="DocumentResultMap">
        SELECT
            uuid,
            drafter,
            draft_time,
            title,
            content,
            type,
            secondary_category,
            tertiary_category,
            status,
            create_time,
            update_time
        FROM documents
        WHERE status = 1
        ORDER BY create_time DESC
    </select>

    <!-- 根据UUID查询文档 -->
    <select id="selectByUuid" parameterType="string" resultMap="DocumentResultMap">
        SELECT
            uuid,
            drafter,
            draft_time,
            title,
            content,
            type,
            secondary_category,
            tertiary_category,
            status,
            create_time,
            update_time
        FROM documents
        WHERE uuid = #{uuid} AND status = 1
    </select>

    <!-- 更新文档 -->
    <update id="updateDocument" parameterType="com.personal.website.pojo.Document">
        UPDATE documents
        SET
            title = #{title},
            content = #{content},
            type = #{type},
            secondary_category = #{secondaryCategory},
            tertiary_category = #{tertiaryCategory},
            update_time = NOW()
        WHERE uuid = #{uuid}
    </update>

    <!-- 删除文档（逻辑删除） -->
    <update id="deleteDocument" parameterType="string">
        UPDATE documents
        SET status = 0
        WHERE uuid = #{uuid}
    </update>

    <!-- 分页查询文档 -->
    <select id="selectAllDocumentsWithPagination" parameterType="map" resultMap="DocumentResultMap">
        SELECT
            uuid,
            drafter,
            draft_time,
            title,
            content,
            type,
            secondary_category,
            tertiary_category,
            status,
            create_time,
            update_time
        FROM documents
        WHERE status = 1
        ORDER BY create_time DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 获取总数 -->
    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*) FROM documents
        WHERE status = 1
    </select>

    <!-- 根据类型查询文档 -->
    <select id="selectByType" parameterType="string" resultMap="DocumentResultMap">
        SELECT
            uuid,
            drafter,
            draft_time,
            title,
            content,
            type,
            secondary_category,
            tertiary_category,
            status,
            create_time,
            update_time
        FROM documents
        WHERE status = 1 AND type = #{type}
        ORDER BY create_time DESC
    </select>

</mapper>